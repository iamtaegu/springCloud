#### mvn clean package dockerfile:build && docker-compose -f docker/docker-compose.yml up 

## 10.3.2 조직 서비스에서 메시지 생산자 작성

    * 의도 
        - 조직 데이터가 추가, 수정, 삭제될 때마다 조직 서비스가 카프카 토픽에 메시지를 발행하여 조직 변경 이벤트 알림

    * 참고     
        - 모든 통신은 스프링 클라우드 스트림의 채널(channel)이라는 자바 인터페이스 클래스로 함 
            * output() 메서드를 노출하는 Source 인터페이스를 사용
            * source.output()
        - 메시지 브로커뿐만 아니라 특정 메시지 큐에 조직 서비스를 바인딩하는 방법은 구성 설정으로 수행
        - 아파치 주키퍼는 구성 정보 및 이름 데이터를 유지 관리하는 데 사용되고, 분산 시스템에서 유연한 동기화를 제공

    * 처리 
        1. 의존성 추가 
            - 스프링 클라우드 스트림
            - 스프링 클라우드 카프카
        2. 스프링 클라우드 스트림의 메시지 브러커와 바인딩하도록(메시지를 발행하고 소비) 지정 
            - 부트스트랩 클래스에 @EnableBinding(Source.class) 애너테이션 추가 
        3. UserContext 변수를 ThreadLocal로 만들기
            - 멤버변수를 ThreadLocal로 저장하면 현재 스레드에 대한 데이터를 스레드별로 저장할 수 있음 
            - 여기에 설정된 정보는 그 값을 설정한 스레드만 읽을 수 있음
        4. 메시지 발행 로직 작성
            - SimpleSourceBean
        5. 메시지 발생
            - OrganizationService

    * 검토
        - 어떤 데이터를 메시지에 넣어야 할까 ?
            * 정확하게 얼마나 많은 데이터를 메시지에 넣어야 하는가? 
            * 예제에서는
                - 변경된 조직 레코드의 조직 ID만 전달
                - 메시지에 변경된 데이터의 복사본을 넣지 않고
                - 시스템 이벤트에 기반을 둔 메시지를 사용하여 데이터 상태가 변경되었음을 알리고
                - 항상 다른 서비스가 데이터의 새 복사본을 조회하기 위해 원본에서 가져오게 함
                - 실행 시간 면에서 비용이 더 들지만, 항상 최신 데이터 복사본을 보장할 수 있음

## 10.3.3 라이선싱 서비스에서 메시지 소비자 작성

    * 처리 
        1. 의존성 추가 
            - 스프링 클라우드 스트림
            - 스프링 클라우드 카프카
        2. 스프링 클라우드 스트림의 메시지 브러커와 바인딩하도록(메시지를 발행하고 소비) 지정 
            - 부트스트랩 클래스에 @EnableBinding(Sink.class) 애너테이션 추가 
